# ANR 解析

## 什么是 ANR
ANR 全称是 Application Not Responding，意思就是程序未响应。如果一个应用无法响应用户的输入，系统就会弹出一个 ANR 对话框，用户可以自行选择继续等待或者是停止当前程序。

## 出现场景
* 主线程被 IO 操作（从 4.0 之后网络 IO 不允许在主线程中）阻塞。
* 主线程中存在耗时的计算
* 主线程中错误的操作，比如 Thread.wait 或者 Thread.sleep 等。

Android 系统会监控程序的响应状况，一旦出现下面两种情况，则弹出 ANR 对话框：
* 应用在 5 秒内未响应用户的输入事件（如按键或者触摸）
* BroadcastReceiver 未在 10 秒内完成相关的处理

## 如何避免
基本的思路就是将 IO 操作在工作线程来处理，减少其他耗时操作和错误操作。
* 使用 AsyncTask 处理耗时 IO 操作。
* 使用 Thread 或者 HandlerThread 时，调用 Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND)设置优先级，否则仍然会降低程序响应，因为默认 Thread 的优先级和主线程相同。
* 使用 Handler 处理工作线程结果，而不是使用 Thread.wait() 或者 Thread.sleep() 来阻塞主线程。
* Activity 的 onCreate 和 onResume 回调中尽量避免耗时的代码。
* BroadcastReceiver 中的 onReceive 代码也要尽量减少耗时，建议使用 Intentservice 处理。

## 画龙点睛




