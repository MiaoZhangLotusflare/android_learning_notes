## 智慧课堂项目的功能

## 1. 平板管控

### 1.1. 功能描述

　　老师端设置应用白名单，白名单的应用可以打开，不在白名单中的应用拒绝打开。

### 1.2. 功能点

　　进程保活

### 1.2. 功能实现

　　会在在主程序 onCreate() 会调用中开启 ManagerAppService服务。ManagerAppService服务管理平板管控的规则更新、打开应用、启动管控等消息的处理。

　　检查管控规则变化的地方：

1. 在 onCreate() 中开启管控，将一些默认的应用加入白名单。
2. 会间隔一天从外网获取管控规则，检查管控规则是否有变化。
3. RabbitMQ 发送消息过来，开启管控或者检查管控规则变化。
4. 开始上课时，使用内网再次检查管控。

　　如果 ManagerAppService接收到管控规则更新的信息，就开启 UpdateRuleService 服务，UpdateRuleService 服务是在一个单独的进程中，接收到管控规则更新的消息后，会去请求新的管控规则，将其与旧的管控规则进行对比，如果与旧的规则不同，则将其保存到 ContentProvider 中（这个数据库是给系统使用的，如果在白名单就允许安装，如果不在白名单就不允许安装）和 SharedPreferences 中（应用自己使用）。

　　打开管控后，会注册 FrameworkReceiver 广播接收器，这是一个自己与系统开发人员定制的广播接收器，当打开一个应用时，FrameworkReceiver 就会接收到消息，然后将消息传递给 ManagerAppService 服务中去，ManagerAppService收到消息，会判断打开应用是否在白名单中，如果在，不拦截打开应用并且设置应用可以使用 wifi（反射调用 WifiManager 的 setWifiDataRule 方法），如果不在，则强制停止应用（反射调用 ActivityManager 的 forceStopPackage 方法），并弹出 toast 提示用户 “ 此应用已被禁用 ”，并且设置应用不可以打开 wifi。

　　因为 ManagerAppService需要处理管控的操作，所以就需要在应用退出到后台， ManagerAppService也能够在存活，在用户点击其他应用时，对应用进行管控。

　　为了尽可能提高 ManagerAppService保活，使用了 双进程守护 + 前台服务 + JobScheduler 三种手段来处理。

　　KeepLiveService 继承 JobService，在 onStartJob 中检查 ManagerAppService 时候存活，如果不，则启动 ManagerAppService 服务，在 ManagerAppService 的 onStartCommand() 方法中启动并绑定 KeepLiveService ，在绑定断开的时候再次启动并绑定 KeepLiveService。



## 2. HTML 解析

[Java开源Html解析类库](http://blog.chinaunix.net/uid-20767210-id-1849644.html)

[java开源HTML解析器收集](https://blog.csdn.net/xiaomin1991222/article/details/50980475)

[开源Html分析器解析库对比](https://www.jdon.com/45938)

[利用 TagSoup 拯救可怕的 HTML](https://blog.csdn.net/weistar103/article/details/84528738)

[如何使用android中的tagsoup解析xml中的html内容](https://www.jb51.cc/android/308935.html)

[支付宝 Android 版使用的开源组件](https://www.jianshu.com/p/844e338319af)

[TagSoup开发指南](https://blog.csdn.net/iteye_7356/article/details/82071981)