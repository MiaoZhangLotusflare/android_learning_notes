学习视频地址：https://www.bilibili.com/video/BV1wf4y1s7TG?p=7&spm_id_from=pageDriver

## 37. kotlin 的可空性

### null

* 在 Java 中我们司空见惯的空指针异常 NullPointerException，带给了我们很多麻烦。Kotlin 作为更强大的语言，势必会基于以往的语言设计经验对其进行改良。Kotlin 更多地把运行时可能会出现的 null 问题，以编译时错误的方式，提前在变异期强迫我们重视起来，而不是等到运行时报错，防范于未然，提高了我们程序的健壮性。

### 可空性

* 对于 null 值问题，Kotlin 反其道而行之，除非另有规定，变量不可为 null 值，这样以来，运行时崩溃从根源上得到解决。

```kotlin
fun main() {
    var str = "butterfly"
    str = null // 报错
}
```

### kotlin 的 null 类型

* 为了避免 NullPointerException，Kotlin 的做法是不让我们给非空类型变量赋 null 值，但 null 在 Kotlin 中依然存在。

```kotlin
fun main() {
    var str:String? = "butterfly"
    str = null
}
```

加 ? 字符标示是可空类型。

### null 安全

* Kotlin 区分可空类型和非可空类型，所以，你要一个可空类型变量运行，而它又可能不存在，对于这种潜在危险，编译器时刻警惕着。为了应对这种风险，kotlin 不允许你在可空类型值上调用函数，除非你主动接手安全管理。

安装管理的选项：

1. 选项一：安全调用操作符
2. 选项二：使用非空断言操作符
3. 选项三：使用 if 判断 null 值情况

## 38. 安全调用操作符

* 加了安全调用操作符，kotlin就不会报错了，编译器看到有安全调用操作符，所以它知道如何检查 null 值。如果遇到 null 值，它就跳过函数调用，而不是返回 null。

```kotlin
fun main() {
    var str:String? = "butterfly"
    str = null
  	str.capitalize()// 会报错
    println(str?.capitalize()) // ? 就是安全调用操作符，输出：null
}
```

## 39. 使用带 let 的安全调用

* 安全调用允许在可空类型上调用函数，但是如果还想做点额外的事，比如创建新值，或判断不为 null 就调用其他函数，怎么办？可以使用带 let 函数的安全调用操作符。你可以在任何类型上调用 let 函数，它的主要作用是让你在指定的作用域内定义一个或多个变量

```kotlin
fun main() {
    var str:String? = "butterfly"
    str = ""
    str = str?.let {
        // 非空白的字符串
        if(it.isNotBlank()){
            it.capitalize()
        } else {
            "butterfly"
        }
    }
    println(str)
}
```

str =""，输出：butterfly

str ="butterfly"，输出：Butterfly

## 40. 非空断言操作符

* !!. 又称感叹号操作符，当变量值为 null 时，会抛出 KotlinNullPointerException。

```kotlin
fun main() {
    var str:String? = "butterfly"
    str = null
    println(str!!.capitalize())
}
```

out:

```
Exception in thread "main" kotlin.KotlinNullPointerException
	at NullSafeKt.main(NullSafe.kt:16)
	at NullSafeKt.main(NullSafe.kt)
```

## 41. 对比使用 if 判断 null 值情况

* 我们也可以使用 if 判断，但是相比之下安全调用操作符用起来更灵活，代码也更简洁，我们可以用安全操作符进行多个函数的链式调用。

```kotlin
fun main() {
    var str:String? = "butterfly"

		// if...else
    str = null
    if(str != null){
        str = str.capitalize()
    } else {
        println("为null")
    }
    // 链式调用
    str = str?.capitalize().plus(" is great.")
}
```

## 42. 空合并操作符

* ?: 操作符的意思是，如果左边的求值结果为 null，就使用右边的结果值。
* 空合并操作符也可以和 let 函数一起使用来代替 if/else 语句。

```kotlin
fun main() {
    var str:String? = "butterfly"
    str = null
    println(str?:"jack")
}
```

str = null，out：jack

str 为 "butterfly"，out：butterfly

```kotlin
fun main() {
    var str:String? = "butterfly"
    str = null
    str = str?.let { it.capitalize() }?:"butterfly"
    println(str)
}
```

str = null，out：“butterfly”

Str = "jack"，out：“Jack”

## 43. 异常处理与自定义异常

* 抛出异常
* 自定义异常
* 异常处理

```kotlin
import java.lang.Exception
import java.lang.IllegalArgumentException

fun main() {
    var number:Int?=null
    try {
        checkOperation(number)
        number!!.plus(1)
    }catch (e:Exception){
        println(e)
    }

}

fun checkOperation(number:Int?){
    number ?: throw UnskilledException()
}

// 自定义异常
class UnskilledException():IllegalArgumentException("操作不当")

```

out:

```
UnskilledException: 操作不当
```

## 44. 先决条件函数

* Kotlin 标准库提供了一些便利函数，使用这些内置函数，你可以抛出带自定义信息的异常，这些便利函数叫做先决条件函数，你可以用它定义先决条件，条件必须满足，目标代码才能执行。

| 函数           | 描述                                                         |
| -------------- | ------------------------------------------------------------ |
| checkNotNull   | 如果参数为null，则抛出IllegalStateException异常，否则返回非 null 值 |
| require        | 如果参数为 false，则抛出 IllegalArgumentException 异常       |
| requireNotNull | 如果参数为null，则抛出IllegalStateException异常，否则返回非null值 |
| error          | 如果参数为null，则抛出IllegalStateException异常并输出错误信息，否则返回非null值 |
| assert         | 如果参数为 false，则抛出 AssertError异常，并打伤断言编译器标记 |

```kotlin
fun main() {
    var number:Int?=null
    try {
        checkOperation(number)
        number!!.plus(1)
    }catch (e:Exception){
        println(e)
    }

}

fun checkOperation(number:Int?){
    checkNotNull(number,{"Something is not good."})
}
```

Out:

```
java.lang.IllegalStateException: Something is not good.
```

## 45. substring

* 字符串截取，substring 函数支持 IntRange 类型（表示一个整数范围的类型）的参数，unit 创建的范围不包括上限值。

```kotlin
const val NAME = "Jimmy's friend"
fun main() {
    val index = NAME.indexOf('\'')
    val str = NAME.substring(0,index)
    println(str)//out:Jimmy
    val str1 = NAME.substring(0 until index)
    println(str1)//out:Jimmy
}
```

## 46. split

* split 函数返回的是 List 集合数据，List 集合又支持解构语法特性，它允许你在一个表达式里给多个变量赋值，解构常用来简化变量的赋值。

```kotlin
const val NAME = "Jimmy's friend"
const val NAMES = "jack,jacky,jason"
fun main() {

    val data:List<String> = NAMES.split(",")
    println("$data")//out:[jack, jacky, jason]
    val(origin,dest,proxy) = NAMES.split(",")
    println("$origin $dest $proxy")//out:jack jacky jason
}
```

## 47.replace

* 字符串替换

```kotlin
fun main() {
    val str1 = "The people's Republic of china."

    val str2 = str1.replace(Regex("[aeiou]")){
        when(it.value){
            "a" -> "8"
            "e" -> "6"
            "i" -> "9"
            "o" -> "1"
            "u" -> "3"
            else -> it.value
        }
    }

    println(str1)//out:The people's Republic of china.
    println(str2)//out:Th6 p61pl6's R6p3bl9c 1f ch9n8.

}
```

## 48. == 与 === 比较

### 字符串比较

* 在 Kotlin 中，用 == 检查两个字符串中的字符是否匹配，用 === 检查两个变量是否指向内存堆上同一对象，而在 Java 中 == 做引用比较，做结构比较时用 equals 方法。

```kotlin
fun main() {
    val str1 = "Jason"
    val str2 = "Jason"

    println(str1 == str2)//true
    println(str1 === str2)//true，常量池
}
```

```kotlin
fun main() {
    val str1 = "Jason"
    val str2 = "jason".capitalize()

    println(str1 == str2)//true
    println(str1 === str2)//false
}
```

## 49. 字符串遍历

 ### foreach

* 遍历字符

```kotlin
fun main() {
    "The people's Republic of china.".forEach {
        print("$it *")//out:T *h *e *  *p *e *o *p *l *e *' *s *  *R *e *p *u *b *l *i *c *  *o *f *  *c *h *i *n *a *. *
    }
}
```

## 50. 数字类型的安全转换函数

### 数字类型

* 和 Java 一样，Kotlin 中所有数字类型都是有符号的，也就是说既可以表示正数，也可以表示负数。

| 类型   | 位   | 最大值                 | 最小值               |
| ------ | ---- | ---------------------- | -------------------- |
| Byte   | 8    | 127                    | -128                 |
| Short  | 16   | 32767                  | -32768               |
| Int    | 32   | 2147483647             | -2147483648          |
| Long   | 64   | 9223372036854775807    | -9223372036854775808 |
| Float  | 32   | 3.4028235E38           | 1.4E-45              |
| Double | 64   | 1.7976931348623157E308 | 4.9E-324             |

### 安全转换函数

* Kotlin 提供了 toDoubleOrNull 和 toIntOrNull 这样的安全转换函数，如果数值不能正确转换，与其触发异常不如干脆返回 null 值。

```kotlin
fun main() {
    val number1:Int = "8.98".toInt()
}
```

Out:

```
Exception in thread "main" java.lang.NumberFormatException: For input string: "8.98"
	at java.base/java.lang.NumberFormatException.forInputString(NumberFormatException.java:68)
	at java.base/java.lang.Integer.parseInt(Integer.java:658)
	at java.base/java.lang.Integer.parseInt(Integer.java:776)
	at NumberConvertKt.main(NumberConvert.kt:2)
	at NumberConvertKt.main(NumberConvert.kt)

```

```kotlin
fun main() {
    val number1:Int? = "8.98".toIntOrNull()
    println(number1)//null
}
```

## Double 转 Int 与类型格式化

