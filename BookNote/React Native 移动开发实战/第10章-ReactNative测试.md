# 第 10 章 React Native 测试

## 10.1. 软件测试

​		软件测试，就是指使用人工操作或者软件自动运行的方式来检验产品是否实现了规定的需求，或者弄清预期结果与实际结果之间差别的过程。软件测试的目的，就是尽可能多地发现在软件中存在的问题和隐藏的漏洞。

​		根据划分标准的不同，软件测试可以有很多不同的分类。

1. 按阶段划分

   根据测试阶段的不同，可以将测试分为单元测试、集成测试、系统测试和验收测试。

   单元测试，是对软件组成单元进行测试，其目的是检验软件基本组成单位的正确性。测试的对象是软件设计的最小单位模块，所以单元测试又称为模块测试。

   集成测试，也称联合测试、组装测试，是将程序模块采用适当的集成策略组装起来，对系统的接口及集成后的功能进行测试。集成测试的主要目是检查软件单位之间的接口是否正确。

   系统测试，是指经过集成测试后，与系统中其他部分结合起来进行测试，测试内容包括功能、性能以及软件所运行的软硬件环境。

   验收测试，是部署软件之前的最后一项测试操作，是软件产品在完成单元测试、集成测试和系统测试之后，产品发布之前所进行的软件测试活动，所以也称为交付测试。验收测试的目的是确保软件准备就绪，按照项目合同、任务书、双方约定的验收依据文档，向软件购买者展示该软件系统满足原始需求。

2. 按是否能够查看源代码划分

   按照是否能够查看软件源码的角度划分，可以将测试分为黑盒测试、白盒测试和灰盒测试。黑盒测试，也称功能测试，主要通过测试每个功能来检测程序是否能够正常工作。黑盒测试中，把被测的程序当成一个黑盒子，在完全不考虑程序内部结构和内部特性的情况下，检测程序是否能够正确地接收输入数据和产生正确的输出信息。

   白盒测试，又称结构测试、透明盒测试、逻辑驱动测试或基于代码的测试。白盒测试需要了解程序的内部逻辑结构，并对所有逻辑路径进行测试。

   灰盒测试，是介于白盒测试与黑盒测试之间的一种测试方法，多用于集成测试阶段，不仅关注输出、输入的正确性，同时也关注程序内部的情况。灰盒测试不像白盒测试那样详细、完整，但又比黑盒测试更关注程序的内部逻辑，常常是通过一些表征性的现象、事件、标志，来判断程序内部的运行状态。

3. 按是否执行程序划分

   按照是否执行程序的角度划分，测试可以分为静态测试和动态测试。

   静态测试，是指不运行被测程序本身，仅通过分析或检查源程序的语法、结构、过程、接口等来检查程序的正确性。并通过对需求规格说明书、软件设计说明书、源程序做结构分析、流程图分析、符号执行，来找出程序中潜在的错误。

   动态测试，是指通过运行被测程序，检查运行结果与预期结果的差异，并分析运行效率、正确性和健壮性等性能。动态测试通常由构造测试用例、执行程序和分析程序的输出结果组成。

## 10.2. React Native 单元测试

### 10.2.1. 环境与配置

​		单元测试是最基本的测试手段，是对软件中最小可测试单元进行检查和验证，其基本思想是只测试应用程序的某个功能，通常是一个特定功能的函数。这意味着这个函数依赖的其他部分在单元测试中是用不到的，需要在使用的时候模拟一个假对象。在单元测试中，模拟的假对象被称为模拟对象，创建它的过程被称为模拟。

​		目前，Jest+Enzyme 组合是 React 单元测试中比较流行的做法，相对于 React 的单元测试，Facebook 官方则建议开发者使用 Jest+react-test-renderer 组合来对 React Native 项目进行单元测试。

### 10.2.2. 快照测试

​		快照测试，是最简单的单元测试。快照测试会在第一次运行测试文件时保存一份快照文件，以后每次运行快照测试时，都会和第一次生成的快照文件进行比较，除非使用 npm test -- -u 命令重新生成快照文件。

​		快照测试需要用到 react-test-renderer 库。

### 10.2.3. 覆盖率

​		在软件开发中，单元测试可以有效地发现应用程序中潜在的缺陷，然后修复，进而提高代码的健壮性和稳定性。那么，如何衡量单元测试是否符合要求呢，此时就需要借助测试覆盖报告。

​		测试覆盖报告是衡量单元测试结果的重要手段，它主要有 4 个检测指标：语句覆盖率、行覆盖率、分支覆盖率和函数覆盖率。

* 语句覆盖率：是不是每一个语句都被覆盖。
* 行覆盖率：是不是每一行代码都被覆盖。
* 分支覆盖率：是不是每一个if代码块都被覆盖。
* 函数覆盖：是不是每一个函数都被覆盖。

​		如果要生成整个工程的测试覆盖报告，只需要在工程的根目录执行 npm test ----coverage 命令即可。

## 10.3. Jest

​		Jest 是 Facebook 技术团队开源的一套针对 JavaScript 的单元测试框架，它由另一个著名的 JavaScript 单元测试框架 Jasmine 演变而来，支持快照、异步代码和自动生成静态分析等。

### 10.3.1. 匹配与断言

​		在进行单元测试时，经常需要对实际输出结果和预期结果进行比对，以便检查实际输出结果是否满足预期结果，使用 Jest 提供的 expect() 和 matchers() 方法可以达到这一目的。Expect 用于匹配测试，Matchers 用于断言测试。

​		Jest 也支持使用 expect.extend() 方法来自定义匹配器。

### 10.3.2. 全局函数

​		在单元测试中，如果要测试某个函数，最常用的方法是导入函数所在的类，再编写测试函数。现在，借助 Jest 提供的全局函数，不导入函数所在的类，也可以对函数进行单元测试。

### 10.3.3. Mock 测试

​		所谓 Mock 测试，就是在测试过程中，对于某些不容易构造或者不容易获取的对象，使用一个虚拟的对象进行替换以便测试其他内容的单元测试。Mock 测试既可以用于模拟数据，也可以用于模拟行为。

​		为了避免出现编译出错的情况，有时候还需要借助 mock() 方法来模拟原生平台的参数和配置。

### 10.3.4. 异步函数

​		在 React Native 应用开发中，经常需要执行一些异步操作。由于异步操作是一个异步的过程，使用 Jest 进行异步函数测试时，Jest 需要知道当前测试的代码是否已经执行完成，只有在执行完成之后才能进行另外的测试。也就是说，测试的用例一定要在测试对象执行结束之后才能够运行。

​		目前，Jest 支持 3 种异步测试，即回调函数、Promise 和 Async/Await。其中，最常见的就是回调函数。

​		除了回调函数和 Promise 方式外，还可以使用 ES7 提供的 async/await 方式来处理异步操作。如果要测试 async/await 异步操作，只需要在测试的函数前面添加 async 关键字修饰即可。

### 10.3.5. Enzyme

​		Enzyme 是 Airbnb 开源的针对 React 的 JavaScript 测试工具，它提供了一套功能简捷且强大的 API，可以帮助开发者像使用 jQuery 操作虚拟 DOM 一样来操作 React 的虚拟 DOM。

​		同时，Enzyme 还兼容大多数断言库和测试框架，如 chai、mocha 和 jasmine 等。

​		目前，Enzyme 支持 3 种方式的渲染，分别是 shallow、render 和 mount。

## 10.4. 本章小结

​		软件测试是保证软件质量的重要手段。软件测试的方式有很多种，并且大部分情况下是由软件测试人员负责的。不过，单元测试是个例外，它通常需要开发人员通过编写测试脚本来完成。除了提高代码质量外，单元测试还可以帮助其他开发人员理解代码逻辑。