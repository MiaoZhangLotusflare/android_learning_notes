# 第 3 章 依赖倒置原则

## 3.1 依赖倒置原则的定义
　　依赖倒置原则（Dependence Inversion Principle,DIP）的原始定义是：

　　High level modules should not depend upon low level modules. Both should depend upon abstractions. Abstractions should not depend upon details. Details should depend upon abstractions.

　　翻译过来，包含三层含义：

* 高层模块不应该依赖低层模块，两者都应该依赖其抽象；
* 抽象不应该依赖细节；
* 细节应该依赖抽象。

　　每一个逻辑的实现都是由原子逻辑组成的，不可分割的原子逻辑就是低层模块，原子逻辑的再组装就是高层模块。

　　再 Java 语言中，抽象就是指接口或抽象类，两者都是不能直接被实例化的；细节就是实现类，实现接口或继承抽象类而产生的类就是细节，其特点就是可以直接被实例化，也就是可以加上一个关键字 new 产生一个对象。

　　依赖倒置原则在 Java 语言中的表现就是：

* 模块间的依赖通过抽象发生，实现类之间不发生直接的依赖关系，其依赖关系是通过接口或抽象类产生的；
* 接口或抽象类不依赖于实现类；
* 实现类依赖接口或抽象类。

　　更加精简的定义就是 “面向接口编程” - OOD（Object-Oriented Design，面向对象设计）的精髓之一。

## 3.2 言而无信，你太需要契约
　　采用依赖倒置原则可以减少类间的耦合性，提高系统的稳定性，降低并行开发引起的风险，提高代码的可读性和可维护性。

　　接口只是一个抽象化的概念，是对一类事物的最抽象描述，具体的实现代码由相应的实现类来完成。

　　注意：在 Java 中，主要定义变量就必然要有类型，一个变量可以有两种类型：表面类型和实际类型，表明类型是在定义的时候赋予的类型（接口或抽象类或类的类型），实现类型是对象的类型。

　　抽象是对实现的约束，对依赖者而言，也是一种契约，不仅仅约束自己，还同时约束自己与外部的关系，其目的是保证所有的细节不脱离契约的范畴，确保约束双方按照既定的契约（抽象）共同发展，只要抽象这根基线在，细节就脱离不了这个圈圈，始终让你的对象做到 “ 言必信，行必果 ”。

## 3.3 依赖的三种写法

　　只要做到抽象依赖，即使是多层的依赖传递也无所畏惧！

　　对象的依赖关系有三种方式来传递：

1. 构造函数传递对象

　　在类中通过构造函数声明依赖对象，按照依赖注入的说法，这种方法叫做构造函数注入。

```java
public Driver(ICar car); // 类的构造方法
```

2. Setter 方法传递依赖对象

　　在抽象中设置 Setter 方法声明依赖关系，依照依赖注入的说法，这是 Setter 依赖注入。

```java
public void setCar(ICar car); //接口的 set 方法
```

3. 接口声明依赖对象

　　在接口的方法中声明依赖对象，该方法也叫做接口注入。

```java
public void drive(ICar car); //接口方法
```

## 3.4  最佳实践

　　依赖倒置原则的本质就是通过抽象（接口或抽象类）使各个类或模块的实现彼此独立，不互相影响，实现模块间的松耦合。

　　如何在项目中使用这个规则呢？主要遵循以下的几个规则就可以：

* 每个类尽量都有接口或抽象类，或者抽象类和接口两者都具备

　　这是依赖倒置的基本要求，接口和抽象类都是属于抽象的，有了抽象才可以依赖倒置。

* 变量的表面类型尽量使接口或者是抽象类

　　变量的类型不一定要是接口或者抽象类，工具类一般就不需要。如果要使用类的 clone 方法，就必须使用实现类，这个是 JDK 提供的一个规范。

* 任何类都不应该从具体类派生

　　只要不超过两层的继承都是可以忍受的。

* 尽量不要覆写基类的方法

　　如果基类是一个抽象类，而且这个方法已经实现了，子类尽量不要覆写。类间依赖的是抽象，覆写了抽象方法，对依赖的稳定性会产生一定的影响。

* 结合里氏替换原则使用

　　接口负责定义 public 属性和方法，并且声明与其他对象的依赖关系，抽象类负责公共构造部分的实现，实现类准确的实现业务逻辑，同时在适当的时候对父类进行细化。

　　依赖倒置原则的有点在小型项目中很难体现出来，但是在一个大中型项目中，采用依赖倒置原则有非常多的优点，特别是规避一些非技术因素引起的问题。项目越大，需求变化的概率也越大，通过采用依赖倒置原则设计的接口或抽象类对实现类进行约束，可以减少需求变化引起的工作量剧增的情况。人员的变动在大中型项目中也是时常存在的，如果设计优良、代码结构清晰，人员变化对项目的影响基本为零。大中型项目的维护周期一般都很长，采用依赖倒置原则可以让维护人员轻松地扩展和维护。

　　依赖倒置原则是 6 个设计原则中最难以实现地原则，它是实现开闭原则的重要突进，依赖倒置原则没有实现，就别想实现对外扩展开放，对修改关闭。在项目中，只要记住是 “ 面向接口编程 ” 就基本上捉住了依赖倒置原则的核心。

