# 第 16 章 重构 SerialDate

​		如果你访问 http://www.jfree.org/jcommon/index.php，就能找到 JCommon 类库。深入该类库，其中有个名为 org.jfree.date 的程序包。在该程序包中，有个名为 SerialDate 的类。我们即将剖析这个类。（本章是一个重构例子）

​		SerialDate 是一个用 Java 呈现一个日期的类。为什么在 Java 已经有 java.util.Date 和 java.util.Calendar 的时候，还需要一个呈现日期的类呢？作者编写这个类，是为了响应我自己也常感到的痛苦。在开放的 Javadoc（第67行）中，他很好地解释了原因。我们可以质疑他的初衷，但我的确有处理这个问题的需要，而且我也欢迎有个关心日期甚于时间的类存在。

## 16.1. 首先，让它能工作

​		先写测试用例。

## 16.2. 让它做对

​		我们将从头到尾遍历 SerialDate，同时加以改进。在每次做修改后，我还是要运行全部 JCommon 单元测试，包括我为 SerialDate 改进的那些单元测试。所以，后面你看到的所有修改，对于 JCommon 都是可工作的。

## 16.3. 小结

​		我们再一次遵从了童子军军规。我们签入的代码，要比签出时整洁了一点。虽然花了点时间，不过很值得。测试覆盖率提升了，修改了一些缺陷，代码清晰并缩短了。后来者有望比我们更容易地应付这些代码。他也有可能把代码整理得更干净些。

## 16.4. 文献

​		本章的好几个审读者都不这么认为。他们主张，在开源框架中，手工控制序列 ID 会比较好，因为较小的修改不会导致序列化后的日期无效。这是种中肯的观点。然而，尽管会不方便，但失败就会有个清晰的原因。另一方面，如果该类的作者忘记更新序列 ID，则失败模式就会不可预期，而且可能会隐藏得很深。我认为，这个故事的精髓在于，不应该跨版本做反序列化处理。

